/**
 * @license
 * Copyright 2015 ubs121
 */


/** @constructor */
var Resolver = function() {
 /** @type {!Function} */
 this.resolve;

 /** @type {!Function} */
 this.reject;

 /** @type {!Promise} */
 this.promise = new Promise((function(res, rej) {
   this.resolve = res;
   this.reject = rej;
 }).bind(this));
};

var DataService = function() {
 this.db_ = null;
 this.deck_ = null;
 this.card_ = null;

 window.ds = this;
};

DataService.prototype.connect = function() {
   var resolver = new Resolver();

   if (this.db_ != null) {
     resolver.resolve(this.db_);
   }

   var req = window.indexedDB.open('flashcard');

   req.onsuccess = function(ev) {
     resolver.resolve(ev.target.result);
   };

   req.onerror = function(e) {
     resolver.reject(e);
   };

   req.onupgradeneeded = function(ev) {
     var rawDb = ev.target.result;
     var md = rawDb.createObjectStore(TABLE.DECK, { keyPath: 'id' });
     var mc = rawDb.createObjectStore(TABLE.CARD, { keyPath: 'question' });
     mc.createIndex('ixInterval', 'interval', { unique: false });
   };

   return resolver.promise;
};

DataService.prototype.getDecks = function() {

}

DataService.prototype.nextCard() {
}

DataService.prototype.updateInterval(c) {

}

DataService.prototype.importCsv(deckName, csvString) {
}
