
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="flip-animation.html">

<dom-module id="flash-card">
<style>
  :host {
    display: block;
    vertical-align: middle;
    text-align: center;
  }

  neon-animated-pages {
    position: relative;
  }

  neon-animatable {
    min-height: 300px;
    top: 10px;
    left: 10px;
    bottom: 10px;
    right: 10px;
    @apply(--shadow-elevation-2dp);
  }
</style>

<template>
    <div class="layout vertical" >
      <p>Card: <span>{{card.id}}<span></p>

      <!-- card flip -->
      <neon-animated-pages id="pages" class="flex" on-tap="_flip" selected="0">
        <neon-animatable>
            <p id="question"></p>
        </neon-animatable>
        <neon-animatable>
            <p id="answer"></p>

        </neon-animatable>
      </neon-animated-pages>


      <!-- buttons -->
      <div id="buttons" class="fixed-bottom layout horizontal" style="margin: 10px">
        <paper-button raised on-tap="_reset">:-(</paper-button>
        <div class="flex"></div>
        <paper-button raised on-tap="_space">зөв санасан</paper-button>
      </div>

    </div>
</template>

  <script>
    Polymer({
      is: 'flash-card',

      properties: {
        card: {type: Object, value: {}, notify: true},
        deck: {type: String, value: 1, observer: '_deckChanged'}
      },

      created: function() {
        console.log('Card created: ', new Date());
      },

      ready: function() {
        this.$.pages.selected = 0;
        this._next();
      },

      _deckChanged: function() {
        console.log('Selected deck: ' + this.deck);

        //this._next();
      },

      // next card
      _next: function() {
        // TODO: slide effect оруулвал зүгээр

         //this.$.pages.entryAnimation = "slide-right-animation";
         //this.$.pages.exitAnimation = "flip-out-animation";
         //this.$.pages.selected = 0;

        db.nextCard().then(function(c) {

           this.card = c;
           this.$.question.innerText = c.question;
           this.$.answer.innerText = "";
           this.$.pages.selected = 0;
        }.bind(this));
      },

        // Very basic spaced repetition.
  		_space: function(e) {
  		  e.preventDefault();
  			if (this.card.interval) {
  			   this.card.interval = 2 * this.card.interval;
  			} else {
               this.card.interval = 1.0;
            }

            db.updateInterval(this.card);
            this._next();
  		},

      // Цээжлээгүй бол интервалыг шинэчилэн давтах
  		_reset: function(e) {
  		  e.preventDefault();

  			if (this.card.interval) {
  			  this.card.interval = 1.01 * this.card.interval;
  			} else {
              this.card.interval = 0.3;
            }

            db.updateInterval(this.card);
            this._next();
  		},

      add: function() {
        // TODO: add new card
        console.log('add new card');
      },

      _flip: function(e) {
        e.preventDefault();

        this.$.pages.entryAnimation = "flip-in-animation";
        this.$.pages.exitAnimation = "flip-out-animation";

        if (this.$.pages.selected === 0) {
          this.$.answer.innerText = this.card.answer;
          this.$.pages.selected = 1;
        } else {
          this.$.pages.selected = 0;
        }
      }


    });
  </script>

</dom-module>
